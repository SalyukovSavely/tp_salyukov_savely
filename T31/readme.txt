#!/bin/bash

# Проверка количества аргументов в командной строке. Если аргементов не 2, скрипт выводит инструкцию и завершает работу
if [ $# -ne 2 ]; then
    echo "Usage: $0 <input_directory> <output_directory>"
    exit 1
fi

# Присваивание переменным input_dir и output_dir значений первого и второго аргумента скрипта соответственно
input_dir="$1"
output_dir="$2"

# Нахождение всех файлов в указанной директории input_dir
find "$input_dir" -type f -print0 | while IFS= read -r -d '' file; do
    # Получение базового имени файла (без пути) для каждого найденного файла
    base_name=$(basename "$file")
    # Формирование пути для копирования файла в выходную директорию
    target_file="$output_dir/$base_name"
    # Установка счетчика для уникального именования файлов, если в целевой директории уже есть файл с таким именем
    counter=1
    # Проверка наличия файла по сформированному пути. Если файл существует, изменяет имя файла, добавляя счетчик
    while [ -e "$target_file" ]; do
        target_file="${output_dir}/${base_name%.*}_$counter.${base_name##*.}"
        let counter+=1
    done
    # Копирование файла из исходного пути в новый путь с учетом возможного нового имени
    cp "$file" "$target_file"
done